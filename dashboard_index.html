<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Local Dashboards Index</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            margin: 2rem;
            background: #0e1117;
            color: #e6edf3;
        }

        h1 {
            font-size: 1.9rem;
            margin-bottom: .25rem;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 1rem;
        }

        th,
        td {
            padding: .55rem .7rem;
            border: 1px solid #30363d;
            font-size: .9rem;
        }

        th {
            background: #161b22;
            text-align: left;
        }

        tr:nth-child(even) {
            background: #1c2128;
        }

        a {
            color: #58a6ff;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        .status-up {
            color: #3fb950;
            font-weight: 600;
        }

        .status-down,
        .status-error {
            color: #f85149;
            font-weight: 600;
        }

        .pill {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: .7rem;
            letter-spacing: .5px;
            background: #30363d;
        }

        footer {
            margin-top: 2.5rem;
            font-size: .75rem;
            opacity: .65;
        }

        .loading {
            opacity: .6;
        }
    </style>
</head>

<body>
    <h1>Local Dashboards</h1>
    <p id="summary" class="loading">Loading service status...</p>
    <table id="dashTable" hidden>
        <thead>
            <tr>
                <th>Name</th>
                <th>Port</th>
                <th>Status</th>
                <th>Health</th>
                <th>PID</th>
                <th>Link</th>
                <th>Script</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h2>Static & External References</h2>
    <ul>
        <li><a href="frontend/dist/index.html" target="_blank">Frontend Dist (Relative)</a></li>
        <li><a href="autogen/frontend/dist/index.html" target="_blank">Autogen Frontend Dist</a></li>
        <li><a href="executive_dashboard.html" target="_blank">Executive Dashboard (Static)</a></li>
        <li><a href="mobile_dashboard.html" target="_blank">Mobile Dashboard (Static)</a></li>
    </ul>

    <script>
        async function loadStatus() {
            try {
                const r = await fetch('dashboards_status.json?_=' + Date.now());
                if (!r.ok) throw new Error('HTTP ' + r.status);
                const data = await r.json();
                const tbody = document.querySelector('#dashTable tbody');
                tbody.innerHTML = '';
                let upCount = 0;
                data.forEach(s => {
                    if (s.Running) upCount++;
                    const tr = document.createElement('tr');
                    const healthClass = 'status-' + (s.HealthStatus || 'down');
                    tr.innerHTML = `
        <td><span class="pill">${s.Type || ''}</span> ${s.Name}</td>
        <td>${s.Port}</td>
        <td>${s.Running ? '<span class="status-up">RUNNING</span>' : '<span class="status-down">OFF</span>'}</td>
        <td><span class="${healthClass}">${s.HealthStatus || 'n/a'}</span></td>
        <td>${s.PID ?? ''}</td>
        <td><a href="${s.URL}" target="_blank">Open</a></td>
        <td><code>${s.Script}</code></td>`;
                    tbody.appendChild(tr);
                });
                document.getElementById('dashTable').hidden = false;
                const summary = document.getElementById('summary');
                summary.classList.remove('loading');
                summary.textContent = `${upCount} / ${data.length} services running`;
            } catch (e) {
                document.getElementById('summary').textContent = 'Failed to load dashboards_status.json: ' + e.message;
            }
        }
        loadStatus();
        setInterval(loadStatus, 10000);
    </script>

    <footer>
        Generated by manage_dashboards.ps1. Refreshes status every 10s. Stop a service via:
        <code>./scripts/manage_dashboards.ps1 -Action stop</code>
    </footer>
</body>

</html>
